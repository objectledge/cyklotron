<?xml version="1.0"?>
<container>
  <adapter-factory class="org.picocontainer.defaults.CachingComponentAdapterFactory">
    <adapter-factory class="org.objectledge.pico.customization.CustomizingConstructorComponentAdapterFactory"/>
  </adapter-factory>

  <component class-key="org.nanocontainer.reflection.StringToObjectConverter"
             class="org.objectledge.pico.LedgeStringToObjectConverter"/>
    
  <component class="org.objectledge.xml.XMLGrammarCache"/>
  <component class="org.objectledge.xml.XMLValidator"/>

  <component class="org.objectledge.configuration.ConfigurationFactory">
    <component-parameter/>
    <component-parameter/>
    <constant-parameter value="/config"/>
  </component>
  <component class="org.objectledge.configuration.CustomizedConfigurationProvider"/>
  <component-adapter class="org.objectledge.pico.customization.CustomizedComponentAdapter">
    <constant-parameter class="java.lang.Class" value="org.jcontainer.dna.Configuration"/>
    <component-parameter class-key="org.objectledge.configuration.CustomizedConfigurationProvider"/>
  </component-adapter>
    
  <component class="org.objectledge.logging.LoggingConfigurator"/>

  <component class="org.objectledge.logging.LoggerFactory"/>
  <component-adapter class="org.objectledge.pico.customization.CustomizedComponentAdapter">
    <constant-parameter class="java.lang.Class" value="org.jcontainer.dna.Logger"/>
    <component-parameter class-key="org.objectledge.logging.LoggerFactory"/>
  </component-adapter>

  <!-- end of core config -->



  <!-- base components -->
  <component class="org.objectledge.context.Context"/>
  <component class-key="org.objectledge.coral.Instantiator"
             class="org.objectledge.coral.PicoInstantiator"/>
  
  <!-- database -->

  <component class-key="org.objectledge.database.Transaction"
             class="org.objectledge.database.JotmTransaction">
     <constant-parameter value="0"/>
     <component-parameter/>
     <component-parameter/>
     <component-parameter/>
  </component>  

  <component class="org.objectledge.database.XaPoolDataSource"/>
  
  <component class="org.objectledge.database.ThreadDataSource">
    <component-parameter class-key="org.objectledge.database.XaPoolDataSource"/>
    <constant-parameter value="0"/>
    <component-parameter/>
    <component-parameter/>
  </component>
  
  <component class="org.objectledge.database.IdGenerator">
    <component-parameter class-key="org.objectledge.database.XaPoolDataSource"/>
  </component>
  
  <component class-key="org.objectledge.database.Database"
             class="org.objectledge.database.DefaultDatabase">
    <component-parameter class-key="org.objectledge.database.ThreadDataSource"/>
    <component-parameter/>
    <component-parameter/>
  </component>
  
  <component class-key="org.objectledge.database.persistence.Persistence"
            class="org.objectledge.database.persistence.DefaultPersistence"/>
  
  <component class="org.objectledge.database.Transaction$GuardValve"/>
  
  <component class="org.objectledge.database.ThreadDataSource$GuardValve"/>
  
  <component key="database-cleanup" class="org.objectledge.pipeline.SimplePipeline">
    <sequence-parameter>
      <component-parameter class-key="org.objectledge.database.Transaction$GuardValve"/>
      <component-parameter class-key="org.objectledge.database.ThreadDataSource$GuardValve"/>
    </sequence-parameter>
  </component>
  
  
  <!-- utility components -->
  
  <component class="org.objectledge.threads.ThreadPool">
    <component-parameter key="database-cleanup"/>
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
  </component>
  <component class="org.objectledge.event.EventWhiteboardFactory"/>
  <component class-key="org.objectledge.event.EventWhiteboard"
             class="org.objectledge.event.DefaultEventWhiteboard"/>
  <component class="org.objectledge.web.WebConfigurator"/>
  <component class-key="org.objectledge.authentication.UserManager"
             class="org.objectledge.authentication.DirectoryUserManager"/>
             
  <component class-key="org.objectledge.templating.Templating"
             class="org.objectledge.templating.velocity.VelocityTemplating"/>

  <component class-key="org.objectledge.i18n.I18n" class="org.objectledge.i18n.xml.XMLI18n"/>
  <component class="org.objectledge.i18n.DateFormatter"/>  
  <component class="org.objectledge.authentication.NamingPolicy"/>
  <component class="org.objectledge.authentication.LoginVerifier"/>
  <component class="org.objectledge.authentication.PasswordGenerator"/>
  <component class="org.objectledge.authentication.PasswordDigester">
    <constant-parameter value="MD5"/>
  </component>
  <component class="org.objectledge.naming.ContextFactory"/>
  
  <component class-key="org.objectledge.scheduler.AbstractScheduler"
             class="org.objectledge.scheduler.db.DBScheduler">
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>             
    <sequence-parameter>
      <!-- here goes listeners -->
    </sequence-parameter>
    <component-parameter/>
  </component>             
  
  <!-- needed by cache factory, but unimplemented ATM -->
  <component class="org.objectledge.notification.Notification"/>
  
  <component class-key="org.objectledge.cache.CacheFactory" 
             class="org.objectledge.cache.DefaultCacheFactory"/>
  
  <component class-key="org.objectledge.parameters.db.DBParametersManager"
             class="org.objectledge.parameters.db.DefaultDBParametersManager"/>
  
  <component class="org.objectledge.mail.MailSystem"/>
  
  <!-- coral -->
  
  <component class-key="org.objectledge.coral.CoralCore" 
             class="org.objectledge.coral.CoralCoreImpl">
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <constant-parameter class="java.lang.Boolean" value="false"/>
  </component>           
  <component class-key="org.objectledge.coral.session.CoralSessionFactory" 
             class="org.objectledge.coral.session.CoralSessionFactoryImpl"/>
  
  <!-- utils -->
  <component class="org.objectledge.encodings.HTMLEntityEncoder"/>
  <component class="org.objectledge.upload.FileDownload"/>
  <!-- // mvc components ////////////////////////////////////////////////////////////// -->
  <!-- mvc basics -->
  <component class="org.objectledge.web.mvc.security.SecurityHelper"/>
  <component class="org.objectledge.web.mvc.finders.NameSequenceFactory"/>
  <!--
  <container key="org.objectledge.web.mvc.finders.MVCFinder.container"/>
  -->
  <component class="org.objectledge.web.mvc.finders.MVCFinder">
    <component-parameter/>
    <!--
     key="org.objectledge.web.mvc.finders.MVCFinder.container"/>
     -->
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
  </component>
  <component class="org.objectledge.i18n.WebI18nToolFactory"/>
  <component class="org.objectledge.i18n.WebDateFormatToolFactory"/>
  <component class="org.objectledge.i18n.I18nAwareTemplateResolver"/>
  <component class-key="org.objectledge.web.mvc.tools.LinkToolFactory"
             class="org.objectledge.web.mvc.tools.LinkToolFactoryImpl"/>
  <component class="org.objectledge.web.mvc.tools.HTMLEntityEncoderToolFactory"/>
  <component class="org.objectledge.web.mvc.components.I18nAwareComponentToolFactory"/>
  <component class="org.objectledge.web.mvc.tools.PageToolFactory"/>
  <component class="org.objectledge.web.mvc.tools.StringToolFactory"/>

  <component class="org.objectledge.web.mvc.tools.UserAgentToolFactory"/>
  <component class="net.cyklotron.cms.CmsToolFactory"/>
  <component class="net.cyklotron.cms.category.CategoryToolFactory"/>
  <component class="net.cyklotron.cms.files.FilesToolFactory"/>
  <component class="net.cyklotron.cms.security.SecurityToolFactory"/>
  <component class="net.cyklotron.util.WorkflowToolFactory"/>
  <component class="pl.caltha.forms.FormToolFactory"/>

  <component class="org.objectledge.templating.tools.ContextTools">
    <sequence-parameter>
      <component-parameter class-key="org.objectledge.i18n.WebI18nToolFactory"/>
      <component-parameter class-key="org.objectledge.i18n.WebDateFormatToolFactory"/>
      <component-parameter class-key="org.objectledge.web.mvc.tools.LinkToolFactory"/>
      <component-parameter class-key="org.objectledge.web.mvc.tools.HTMLEntityEncoderToolFactory"/>
      <component-parameter class-key="org.objectledge.web.mvc.tools.PageToolFactory"/>            
      <component-parameter class-key="org.objectledge.web.mvc.tools.StringToolFactory"/>
      <component-parameter class-key="org.objectledge.web.mvc.components.I18nAwareComponentToolFactory"/>
      <component-parameter class-key="org.objectledge.web.mvc.tools.UserAgentToolFactory"/>
      <component-parameter class-key="net.cyklotron.cms.CmsToolFactory"/>
      <component-parameter class-key="net.cyklotron.cms.category.CategoryToolFactory"/>      
      <component-parameter class-key="net.cyklotron.cms.files.FilesToolFactory"/>      
      <component-parameter class-key="net.cyklotron.cms.security.SecurityToolFactory"/>      
      <component-parameter class-key="net.cyklotron.util.WorkflowToolFactory"/>      
      <component-parameter class-key="pl.caltha.forms.FormToolFactory"/>      
      
    </sequence-parameter>
  </component>      
  <component class="org.objectledge.upload.FileUpload"/>    
  <component class-key="org.objectledge.table.TableStateManager"
             class="org.objectledge.table.TableStateManagerImpl"/>

  <!-- // valves ////////////////////////////////////////////////////////////////////// -->
  <component class="org.objectledge.encodings.RequestParametersHTMLEntityDecoderValve"/>
  <component class="org.objectledge.encodings.MVCResultsHTMLEntityEncoderValve"/>
  <component class="org.objectledge.web.mvc.MVCResultsValve"/>
  <component class="org.objectledge.web.mvc.MVCInitializerValve"/>
  <component class="org.objectledge.authentication.AuthenticationValve"/>
  <component class="org.objectledge.parameters.RequestParametersLoaderValve"/>
  <component class="org.objectledge.i18n.LocaleLoaderValve"/>
  <component class="org.objectledge.i18n.EncodingLoaderValve"/>
  <component class="org.objectledge.web.mvc.actions.ActionExecutorValve"/>
  <component class="org.objectledge.web.mvc.builders.I18nAwareBuilderExecutorValve">
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <constant-parameter value="4"/>
    <constant-parameter value="4"/>
    <component-parameter/>
  </component>
  <component class="org.objectledge.templating.TemplatingContextLoaderValve"/>
  <component class="org.objectledge.templating.tools.ContextToolPopulatorValve"/>
  <component class="org.objectledge.web.PrintExceptionValve"/>
  <component class="org.objectledge.web.mvc.ExceptionRedirectorValve"/>
  <component class="org.objectledge.upload.FileUploadValve"/>
  <component class="org.objectledge.coral.session.CoralSessionInitValve"/>
  <component class="org.objectledge.coral.session.CoralSessionCleanupValve"/>
  <component class="org.objectledge.coral.session.CoralSessionVerificationValve"/>
  <!-- end of valves -->      


  <!-- // pipeline //////////////////////////////////////////////////////////////////////// -->

  <component key="oneTimeProcessingPipeline"
			 class="org.objectledge.pipeline.SimplePipeline">
    <sequence-parameter>			 
      <component-parameter class-key="org.objectledge.authentication.AuthenticationValve"/>
      <component-parameter class-key="org.objectledge.i18n.LocaleLoaderValve"/>
      <component-parameter class-key="org.objectledge.i18n.EncodingLoaderValve"/>
      <component-parameter class-key="org.objectledge.parameters.RequestParametersLoaderValve"/>
      <component-parameter class-key="org.objectledge.upload.FileUploadValve"/>
      <component-parameter class-key="org.objectledge.encodings.RequestParametersHTMLEntityDecoderValve"/>
      <component-parameter class-key="org.objectledge.web.mvc.MVCInitializerValve"/>
      <component-parameter class-key="org.objectledge.coral.session.CoralSessionInitValve"/>
      <component-parameter class-key="org.objectledge.templating.TemplatingContextLoaderValve"/>
      <component-parameter class-key="org.objectledge.web.mvc.actions.ActionExecutorValve"/>
      <component-parameter class-key="org.objectledge.coral.session.CoralSessionVerificationValve"/>
    </sequence-parameter>      
  </component>
  
  <component class="org.objectledge.pipeline.ErrorHandlingPipeline">
    <component-parameter class-key="org.jcontainer.dna.Logger"/>
    <sequence-parameter>
      <component-parameter key="oneTimeProcessingPipeline"/>
      <component-parameter class-key="org.objectledge.templating.tools.ContextToolPopulatorValve"/>
      <component-parameter class-key="org.objectledge.web.mvc.builders.I18nAwareBuilderExecutorValve"/>
    </sequence-parameter>
	<sequence-parameter>
      <component-parameter class-key="org.objectledge.web.mvc.ExceptionRedirectorValve"/>
      <component-parameter class-key="org.objectledge.templating.tools.ContextToolPopulatorValve"/>
      <component-parameter class-key="org.objectledge.web.mvc.builders.I18nAwareBuilderExecutorValve"/>
      <!--
      <component-parameter class-key="org.objectledge.web.PrintExceptionValve"/>
      -->
    </sequence-parameter>
	<sequence-parameter>
      <component-parameter class-key="org.objectledge.coral.session.CoralSessionCleanupValve"/>	
      <component-parameter class-key="org.objectledge.encodings.MVCResultsHTMLEntityEncoderValve"/>
	  <component-parameter class-key="org.objectledge.web.mvc.MVCResultsValve"/>
    </sequence-parameter>
  </component>

  <!-- // dispatchers ///////////////////////////////////////////////////////////////////// -->
    
  <component class="org.objectledge.web.dispatcher.PipelineHttpDispatcher">
    <component-parameter class-key="org.objectledge.pipeline.ErrorHandlingPipeline"/>         
    <component-parameter/>
  </component>
    
  <component class-key="org.objectledge.web.HttpDispatcher" 
             class="org.objectledge.web.dispatcher.SelectorHttpDispatcher">
    <component-parameter/>
    <sequence-parameter>
      <component-parameter class-key="org.objectledge.web.dispatcher.PipelineHttpDispatcher"/>
    </sequence-parameter>
  </component>
    
    
  <!-- // cyklotron stuff ///////////////////////////////////////////////////////////////////// -->    
  
  <component class-key="net.cyklotron.cms.banner.BannerService"
             class="net.cyklotron.cms.banner.internal.BannerServiceImpl"/>

  <component class-key="net.cyklotron.cms.category.CategoryService"
             class="net.cyklotron.cms.category.internal.CategoryServiceImpl"/>

  <component class-key="net.cyklotron.cms.category.query.CategoryQueryService"
             class="net.cyklotron.cms.category.query.internal.CategoryQueryServiceImpl"/>

  <component class-key="net.cyklotron.cms.documents.DocumentService"
             class="net.cyklotron.cms.documents.internal.DocumentServiceImpl"/>

  <component class-key="net.cyklotron.cms.files.FilesService"
             class="net.cyklotron.cms.files.internal.FilesServiceImpl">
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <sequence-parameter>
      <!-- plugins list -->
    </sequence-parameter>
  </component>             
             

  <component class-key="net.cyklotron.cms.httpfeed.HttpFeedService"
             class="net.cyklotron.cms.httpfeed.internal.HttpFeedServiceImpl"/>

  <component class-key="net.cyklotron.cms.integration.IntegrationService"
             class="net.cyklotron.cms.integration.internal.IntegrationServiceImpl"/>

  <component class-key="net.cyklotron.cms.periodicals.PeriodicalsService"
             class="net.cyklotron.cms.periodicals.internal.PeriodicalsServiceImpl">
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <sequence-parameter>
      <!-- plugins list -->
    </sequence-parameter>
  </component>             
             

  <component class-key="net.cyklotron.cms.preferences.PreferencesService"
             class="net.cyklotron.cms.preferences.internal.PreferencesServiceImpl"/>

  <component class-key="net.cyklotron.cms.related.RelatedService"
             class="net.cyklotron.cms.related.internal.RelatedServiceImpl"/>

  <component class-key="net.cyklotron.cms.search.SearchService"
             class="net.cyklotron.cms.search.internal.SearchServiceImpl"/>

  <component class-key="net.cyklotron.cms.security.SecurityService"
             class="net.cyklotron.cms.security.internal.SecurityServiceImpl"/>

  <component class-key="net.cyklotron.cms.site.SiteService"
             class="net.cyklotron.cms.site.internal.SiteServiceImpl">
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <sequence-parameter>
      <!-- here goes listeners -->
    </sequence-parameter>
    <sequence-parameter>
      <!-- here goes listeners -->
    </sequence-parameter>
    <sequence-parameter>
      <!-- here goes listeners -->
    </sequence-parameter>
  </component>

  <component class-key="net.cyklotron.cms.structure.StructureService"
             class="net.cyklotron.cms.structure.internal.StructureServiceImpl"/>

  <component class-key="net.cyklotron.cms.workflow.WorkflowService"
             class="net.cyklotron.cms.workflow.internal.WorkflowServiceImpl">
    <component-parameter/>
    <component-parameter/>
    <component-parameter/>
    <sequence-parameter>
      <!-- here goes listeners -->
    </sequence-parameter>
  </component>             


  <component class-key="pl.caltha.forms.FormsService"
             class="pl.caltha.forms.internal.FormsServiceImpl"/>

  <component class-key="pl.caltha.services.xml.XMLService"
             class="pl.caltha.internal.xml.XMLServiceImpl"/>

  <component class-key="net.cyklotron.cms.documents.HTMLService"
             class="net.cyklotron.cms.documents.internal.HTMLServiceImpl"/>

  <component class="net.cyklotron.cms.CmsDataFactory"/>
  
  <component class-key="net.cyklotron.cms.poll.PollService"
             class="net.cyklotron.cms.poll.internal.PollServiceImpl"/>  

  <!--
  -->           
</container>